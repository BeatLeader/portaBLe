@page
@model FiltersModel

<h2>Top PP Score Rankings</h2>

@if (!string.IsNullOrEmpty(Model.ErrorMessage))
{
    <div class="alert alert-danger" role="alert">
        @Model.ErrorMessage
        <br />
        <small>Selected database: @Model.SelectedDatabase</small>
    </div>
}

<div class="mb-3">
    <form method="get" class="form-inline">
        <div class="input-group" style="max-width: 500px;">
            <input type="text" 
                   name="searchString" 
                   value="@Model.SearchString" 
                   class="form-control" 
                   placeholder="Search players by name..." 
                   aria-label="Search players" />
            <button type="submit" class="btn btn-primary">Search</button>
            @if (!string.IsNullOrEmpty(Model.SearchString))
            {
                <a asp-page="./Filters" class="btn btn-secondary">Clear</a>
            }
        </div>
    </form>
    @if (!string.IsNullOrEmpty(Model.SearchString))
    {
        <small class="text-muted mt-2 d-block">
            Found @Model.Players.Count result(s) for "@Model.SearchString"
        </small>
    }
</div>

@if (Model.Players.Any())
{
    <table class="table">
        <thead>
            <tr>
                <th>Rank</th>
                <th>Name</th>
                <th>Country</th>
                <th>Top PP</th>
                <th>Total PP</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var player in Model.Players)
            {
                <tr>
                    <td>@player.Rank</td>
                    <td><a asp-page="/Player" asp-route-id="@player.Id">@player.Name</a></td>
                    <td>@player.Country</td>
                    <td>@player.TopPp.ToString("F2")</td>
                    <td>@player.Pp.ToString("F2")</td>
                </tr>
            }
        </tbody>
    </table>

    <nav aria-label="Top PP rankings navigation">
        <ul class="pagination">
            @{
                int firstPageToShow = Model.CurrentPage - 5;
                int lastPageToShow = Model.CurrentPage + 4;
                if (firstPageToShow < 1)
                {
                    firstPageToShow = 1;
                    lastPageToShow = 10;
                }
                if (lastPageToShow > Model.TotalPages)
                {
                    lastPageToShow = Model.TotalPages;
                    firstPageToShow = Model.TotalPages - 9 > 1 ? Model.TotalPages - 9 : 1;
                }

                for (int i = firstPageToShow; i <= lastPageToShow; i++)
                {
                    <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                        <a class="page-link" 
                           asp-page="./Filters" 
                           asp-route-currentPage="@i"
                           asp-route-searchString="@Model.SearchString">@i</a>
                    </li>
                }
            }
        </ul>
    </nav>
}
else if (string.IsNullOrEmpty(Model.ErrorMessage))
{
    <div class="alert alert-info">
        No players found.
    </div>
}
